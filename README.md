README.md - 2017-Mar-14 - Kevin Castner

emed contains python scripts to digest event data from EM7 DB instances and create documentation.

The requirements to run these scripts are as follows:
	1) a mysql/mariadb instance (5.5 or higher)
	2) a login for mysql sufficient to create/drop databases
	3) python 2.7 or higher with the following modules (and any second order dependencies)
		a) argparse (1.3.0)
		b) et-xmlfile (1.0.1)
		c) lxml (3.4.4)
		d) msgpack-python (0.4.6)
		e) mysql-connector-python (2.1.4)
		f) MySQL-python (1.2.3rc1)
		g) opc-diag (1.0.0)
		h) openpyxl (2.4.5)
		i) pycurl (7.19.0)
		j) python-docx (0.8.5)
		k) PyYAML (3.11)

File descriptions:
emed-blgen.py - creates an xlsx document intended for client distribution that details event messages and thresholds.  This is referred to as the "baseline" document.

emed-sopgen.py - creates an xlsx document intended for use by the GCC/CC/NOC the details event messages, incident priorities, and initial triage procedures.  This is referred to as the SOP document.

emed-db-populate-events.py - reads an xlsx document and populates the emed database with data to generate the documentation.

setup-emed.sql - sources additional *.sql files in order to correctly setup the emed database.

emed-schema.sql - contains sql statements for emed schema setup

emed-sheets-data.sql - contains sql statements that link dynamic apps to tabs in the output spreadsheets.  This is where all the business logic resides.

createWS.py - source file for python support functions

EVTM.crd - a json formatted file containing the login credentials for the mysql database.  Should be chmod 600 or 640.

README.md - This file

Operation:
From a cold VM where this has never been run before and assuming a linux OS

a) install python 2.7
b) use pip to install python modules as listed above
b) install mariadb 10.0 or mysql 5.5
c) create a user (eventmgt in this example) and assign password and privileges
	i) CREATE USER 'eventmgt'@'localhost' IDENTIFIED BY 'password';
	ii) GRANT ALL PRIVILEGES ON *.* TO 'eventmgt'@'localhost';
	
d) Edit EVTM.crd "emed" entry and set this user's name and password.
e) Setup the emed database with the following command
	i)mysql -u root -p < setup-emed.sql && ./emed-db-populate-events.py
f) run emed-blgen.py or emed-sopgen.py as required to create the output documentation.

Additonal Notes:
1) The file AllEvents_20170309-01.xlsx is currently hard coded into the emed-db-populate-events.py script.  To add additional events this file needs to be added to directly or the populate script needs to be updated to loop through a list.
2) The AllEvents* file is generated by running the following sql against the master db of an EM7 DB stack.

	use master;
	select da.name as AppName, ename as EventName, aa.message as AlertMessage,
		ath.t_value as ThresholdValue, ath.t_unit as ThresholdUnit,
		eseverity as EventSeverity,
		id as EventID, emessage as EventMessage, event_guid as EventGUID,
		ev.app_guid as AppGUID,
		aa.alert_guid as AlertGUID, aa.name as AlertName, ath.name as ThresholdName
		from policies_events as ev
		join dynamic_app as da on ev.app_guid = da.app_guid
		join dynamic_app_alerts as aa on ev.Xoid = aa.alert_id
		join dynamic_app_thresholds as ath on aa.app_guid = ath.app_guid
		order by EventGUID;

	i) put this query in a file on the EM7 DB and run the script as follows
		mysql -u root -p master < sqlquery.sql | sed -e 's/^M//g' > AllEvents.csv
	ii) import the csv file into Excel and save as an xlsx file to import into emed.

